# Pressograph Scrum Configuration
# This file points to Project Genesis for universal Scrum documentation

scrum_framework: ../project-genesis
ai_instructions: ../project-genesis/docs/scrum/AI_AGENT_INSTRUCTIONS.md
language: typescript

# Project-specific settings
project_name: Pressograph
project_type: fullstack-web-app
primary_language: TypeScript
secondary_languages:
  - JavaScript
  - HTML/CSS
  - Node.js

# Scrum settings
sprint_duration: 2 weeks
velocity_target: 25
story_point_scale: fibonacci

# Definition of Done (project-specific additions)
dod_requirements:
  - All tests pass (coverage ≥60%)
  - TypeScript strict mode (no errors)
  - ESLint passes
  - All components use i18n
  - Responsive design verified
  - Accessibility checked (WCAG 2.1 AA)
  - API documentation updated
  - Database migrations tested

# GitHub settings
repository: dantte-lp/pressograph
default_branch: main

# Documentation locations
universal_docs: ../project-genesis/docs/scrum/
project_docs: ./docs/
handoff_reports:
  - docs/reports/HANDOFF_REPORT_INFRASTRUCTURE.md
  - docs/reports/HANDOFF_REPORT_FRONTEND.md
refactoring_docs: ./docs/development/architecture/

# Build and deployment
build_command: npm run build
test_command: npm test
deploy_target: podman-compose

# === TECHNOLOGY STACK ===

# Container Technologies (github.com/containers)
container_engine: podman
container_compose: podman-compose
image_builder: buildah
image_operations: skopeo
oci_runtime: crun
compose_spec_version: "2025"

# Base Image Policy (NO ALPINE)
base_images:
  policy: "no-alpine"
  primary: "debian:trixie-slim"
  fallback: "debian:trixie"

  # Pressograph is NOT RHEL-dependent
  rhel_required: false

  # Currently using
  node_base: "node:lts-trixie"  # Debian Trixie-based Node.js LTS
  nginx_base: "nginx:1.29-trixie-perl"  # Debian Trixie-based Nginx
  postgres_base: "postgres:18-trixie"  # Debian Trixie-based PostgreSQL

# Version Management
version_policy:
  check_sources:
    - "npm registry (frontend/backend packages)"
    - "GitHub releases (React, Node.js)"
    - "Docker Hub (base images)"
    - "Official websites"
  selection_rules:
    - "Use latest stable versions"
    - "Pin ALL versions in package.json"
    - "Pin Node.js version in Containerfile"
    - "NO dev/alpha/beta dependencies"
  pinned_versions:
    node: "24 LTS"
    react: "19.2.0"
    typescript: "5.9.3"
    vite: "7.1.12"
    postgres: "18"
    nginx: "1.29"

# Container Best Practices
container_best_practices:
  - "Multi-stage builds (Node.js build → slim runtime)"
  - "Non-root user (node:1000:1000 for backend, nginx:101:101 for frontend)"
  - ".containerignore for build optimization"
  - "Pin Node.js version in Containerfile (node:lts-trixie)"
  - "Security scan with Trivy (recommended)"
  - "Health checks in compose.yaml (implemented)"
  - "Resource limits defined (implemented)"
  - "Debian Trixie base images (NO Alpine)"
  - "OCI labels for metadata (implemented)"
  - "Read-only filesystem where possible (frontend production)"
  - "Capability dropping with minimal capabilities"
  - "SELinux compatible volume mounts (:z suffix)"

# Pressograph-Specific Container Architecture
container_architecture:
  frontend:
    build_image: "node:lts-trixie"
    runtime_image: "nginx:1.29-trixie-perl"
    containerfile: "deploy/Containerfile"
    multi_stage: true
    non_root_user: "nginx:101"
    health_check: "curl -f http://localhost:80/health"

  backend:
    build_image: "node:lts-trixie"
    runtime_image: "node:lts-trixie"
    containerfile: "server/Dockerfile"
    multi_stage: true
    non_root_user: "nodejs:1001"
    health_check: "node http health check on :3001/health"
    dependencies:
      - "libcairo2"
      - "libpango-1.0-0"
      - "libjpeg62-turbo"
      - "fontconfig"
      - "fonts-dejavu-core"

  database:
    image: "postgres:18-trixie"
    containerfile: null
    non_root_user: "postgres:999"
    health_check: "pg_isready"

# Compose Specification Compliance
compose_compliance:
  version: "Compose Spec 2025 (no version field)"
  features:
    - "YAML anchors for DRY configuration"
    - "Resource limits and reservations"
    - "Health checks with start_period"
    - "Log rotation (k8s-file driver)"
    - "Security options (no-new-privileges, cap_drop)"
    - "OCI labels on all services"
    - "Internal isolated networks"
    - "SELinux volume mounts (:z suffix)"
    - "Traefik integration for HTTPS"
  environments:
    - name: "development"
      file: "deploy/compose/compose.dev.yaml"
      features: "Hot reload, auto npm install, relaxed security"
    - name: "production"
      file: "deploy/compose/compose.prod.yaml"
      features: "Hardened, read-only FS, minimal capabilities"
    - name: "observability"
      file: "deploy/compose/compose.observability.yaml"
      features: "VictoriaMetrics, VictoriaLogs, Grafana, Tempo"

# Validation
validation:
  script: "../project-genesis/scripts/validate-tech-stack.sh"
  required_checks:
    - "No Alpine images in use"
    - "All versions pinned"
    - "Non-root users configured"
    - "Health checks present"
    - "Compose Spec 2025 compliance"
