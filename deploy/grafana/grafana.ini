# ═══════════════════════════════════════════════════════════════════
# Grafana Configuration
# ═══════════════════════════════════════════════════════════════════
# Custom Grafana settings для Pressograph Observability Stack
# Большинство настроек передается через environment variables
# ═══════════════════════════════════════════════════════════════════

[paths]
# Data directory (перезаписывается volume)
data = /var/lib/grafana
# Logs directory
logs = /var/log/grafana
# Plugins directory
plugins = /var/lib/grafana/plugins
# Provisioning directory
provisioning = /etc/grafana/provisioning

[server]
# Protocol (http, https, h2, socket)
protocol = http
# HTTP port (за Traefik, поэтому http)
http_port = 3000
# Domain (устанавливается через env GF_SERVER_DOMAIN)
# domain = grafana-dev.infra4.dev
# Root URL (устанавливается через env GF_SERVER_ROOT_URL)
# root_url = https://grafana-dev.infra4.dev
# Serve from sub path
serve_from_sub_path = false
# Enable gzip
enable_gzip = true

[database]
# Database type (sqlite3, mysql, postgres)
# SQLite для простоты (можно переключить на postgres для production)
type = sqlite3
# SQLite path (в /var/lib/grafana volume)
path = /var/lib/grafana/grafana.db
# Connection pool (для postgres)
# max_open_conn = 100
# max_idle_conn = 100
# conn_max_lifetime = 14400

[session]
# Session provider (memory, file, redis, postgres, mysql)
provider = file
provider_config = sessions
# Cookie name
cookie_name = grafana_session
# Cookie secure (за Traefik с HTTPS)
cookie_secure = false
# Session lifetime
session_life_time = 86400  # 24 hours

[security]
# Admin user (устанавливается через env GF_SECURITY_ADMIN_USER)
# admin_user = admin
# Admin password (устанавливается через env GF_SECURITY_ADMIN_PASSWORD)
# admin_password = admin
# Secret key (устанавливается через env GF_SECURITY_SECRET_KEY)
# secret_key = ...
# Disable gravatar
disable_gravatar = true
# Disable brute force login protection (для dev)
disable_brute_force_login_protection = false
# Cookie samesite mode
cookie_samesite = lax
# Allow embedding
allow_embedding = false
# Strict transport security
strict_transport_security = true
strict_transport_security_max_age_seconds = 86400
# Content security policy
content_security_policy = true

[users]
# Allow users to sign up
allow_sign_up = false
# Allow organization creation
allow_org_create = false
# Auto assign organization
auto_assign_org = true
auto_assign_org_id = 1
auto_assign_org_role = Viewer
# Default theme (dark, light, system)
default_theme = dark
# Home dashboard (можно указать dashboard UID)
# home_dashboard_id = 0

[auth]
# Disable login form
disable_login_form = false
# Disable signout menu
disable_signout_menu = false
# OAuth auto login
oauth_auto_login = false

[auth.anonymous]
# Enable anonymous access
enabled = false
# Organization name
org_name = Main Org.
# Organization role
org_role = Viewer

[auth.basic]
# Enable basic auth
enabled = true

[auth.proxy]
# Enable auth proxy
enabled = false

[analytics]
# Disable reporting
reporting_enabled = false
# Disable check for updates
check_for_updates = false
# Disable plugin updates check
check_for_plugin_updates = false

[log]
# Log mode (console, file, syslog)
mode = console
# Log level (debug, info, warn, error, critical)
level = info
# Log filters (можно указать уровень для конкретных модулей)
# filters = rendering:debug

[log.console]
# Console log level
level = info
# Console format (text, json)
format = text

[metrics]
# Enable internal metrics
enabled = true
# Internal metrics interval
interval_seconds = 10

[metrics.graphite]
# Graphite address (опционально)
# address =
# prefix = prod.grafana.%(instance_name)s.

[tracing.opentelemetry.otlp]
# Enable OpenTelemetry tracing для самой Grafana
# address = tempo:4317
# propagation = jaeger

[snapshots]
# Enable external snapshot server
external_enabled = false

[dashboards]
# Default home dashboard
# default_home_dashboard_path =
# Versions to keep (0 = all)
versions_to_keep = 20
# Min refresh interval
min_refresh_interval = 5s

[explore]
# Enable Explore section
enabled = true

[alerting]
# Enable alerting (Grafana unified alerting)
enabled = true
# Execute alerts timeout
execute_alerts = true
# Evaluation timeout
evaluation_timeout_seconds = 30
# Max attempts
max_attempts = 3

[unified_alerting]
# Enable unified alerting
enabled = true
# Screenshots (требует image renderer)
# capture = false

[smtp]
# SMTP server (опционально для alerting emails)
# enabled = false
# host = localhost:25
# user =
# password =
# from_address = admin@grafana.localhost
# from_name = Grafana

[rendering]
# Image rendering (опционально, требует grafana-image-renderer plugin)
# server_url =
# callback_url =

[panels]
# Disable sanitize html
disable_sanitize_html = false
# Enable alpha panels
enable_alpha = false

[plugins]
# Enable plugins
enable_alpha = false
# Plugin catalog (hide commercial plugins)
plugin_catalog_hidden_plugins = []

[feature_toggles]
# Enable feature flags
# enable = feature1,feature2

[date_formats]
# Date formats
full_date = YYYY-MM-DD HH:mm:ss
interval_second = HH:mm:ss
interval_minute = HH:mm
interval_hour = MM/DD HH:mm
interval_day = MM/DD
interval_month = YYYY-MM
interval_year = YYYY
default_timezone = browser

# ═══════════════════════════════════════════════════════════════════
# NOTES
# ═══════════════════════════════════════════════════════════════════
#
# 1. Environment Variables Override:
#    Все настройки можно переопределить через env variables:
#    GF_SECTION_KEY=value
#    Например: GF_SECURITY_ADMIN_PASSWORD=mysecret
#
# 2. Security:
#    - admin credentials через env variables
#    - secret_key ОБЯЗАТЕЛЬНО уникальный для production
#    - за Traefik с HTTPS (поэтому cookie_secure=false)
#    - disable anonymous access
#
# 3. Database:
#    - SQLite для простоты (один файл, легко бэкапить)
#    - Для production с HA рассмотрите PostgreSQL
#
# 4. Provisioning:
#    - Datasources auto-provisioned из /etc/grafana/provisioning/datasources
#    - Dashboards auto-provisioned из /etc/grafana/provisioning/dashboards
#
# 5. Plugins:
#    - Можно установить через GF_INSTALL_PLUGINS env variable
#    - Или вручную в /var/lib/grafana/plugins
#
# 6. Alerting:
#    - Unified alerting включен (новая система)
#    - Для email alerts настройте SMTP
#    - Можно использовать webhook для Slack/Discord/etc
#
# 7. Performance:
#    - min_refresh_interval = 5s (не перегружайте VictoriaMetrics)
#    - max_concurrent_queries настраивается в datasource
#    - versions_to_keep = 20 (не храним бесконечно версий)
#
# ═══════════════════════════════════════════════════════════════════
