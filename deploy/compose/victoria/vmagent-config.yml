# ==============================================================================
# vmagent Scrape Configuration
# ==============================================================================
# This file contains ONLY scrape_configs for vmagent.
# Global settings, external labels, and remote_write are configured via
# command-line flags in docker-compose.yaml.
#
# vmagent uses Prometheus scrape_configs format but does NOT support:
# - global section (use -promscrape.config.global.scrape_interval flag)
# - remote_write section (use -remoteWrite.url flag)
# - evaluation_interval (vmagent doesn't evaluate rules)
#
# Reference: https://docs.victoriametrics.com/vmagent/
# ==============================================================================

scrape_configs:
  # Scrape vmagent itself
  - job_name: 'vmagent'
    static_configs:
      - targets: ['localhost:8429']
        labels:
          service: vmagent

  # Scrape VictoriaMetrics
  - job_name: 'victoria-metrics'
    static_configs:
      - targets: ['victoria-metrics:8428']
        labels:
          service: victoria-metrics

  # Scrape VictoriaLogs
  - job_name: 'victoria-logs'
    static_configs:
      - targets: ['victoria-logs:9428']
        labels:
          service: victoria-logs

  # Scrape VictoriaTraces
  - job_name: 'victoria-traces'
    static_configs:
      - targets: ['victoria-traces:8428']
        labels:
          service: victoria-traces

  # Scrape vmalert
  - job_name: 'vmalert'
    static_configs:
      - targets: ['vmalert:8880']
        labels:
          service: vmalert

  # Scrape Grafana
  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
        labels:
          service: grafana

  # Scrape Pressograph application (when running)
  - job_name: 'pressograph'
    static_configs:
      - targets: ['pressograph-dev-workspace:3000']
        labels:
          service: pressograph
          app: pressograph-dev
    # Scrape metrics from /api/metrics endpoint if available
    metrics_path: /api/metrics
    scrape_interval: 30s

  # PostgreSQL exporter (from backend network)
  - job_name: 'postgres'
    static_configs:
      - targets: ['pressograph-dev-postgres-exporter:9187']
        labels:
          service: postgres
          app: pressograph-dev
          instance: pressograph-dev-db
    scrape_interval: 30s
    scrape_timeout: 10s

  # Valkey/Redis exporter (from backend network)
  - job_name: 'redis'
    static_configs:
      - targets: ['pressograph-dev-redis-exporter:9121']
        labels:
          service: redis
          app: pressograph-dev
          instance: pressograph-dev-cache
    scrape_interval: 30s
    scrape_timeout: 10s

  # OpenTelemetry Collector metrics (from backend network)
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['pressograph-dev-workspace:9464']
        labels:
          service: otel-collector
          app: pressograph-dev
    scrape_interval: 30s
    scrape_timeout: 10s

  # Node Exporter (if deployed for host metrics)
  # Uncomment when node-exporter is added to the stack
  # - job_name: 'node'
  #   static_configs:
  #     - targets: ['node-exporter:9100']
  #       labels:
  #         service: node-exporter
  #         instance: pressograph-host
  #   scrape_interval: 60s
  #   scrape_timeout: 10s
  #   metric_relabel_configs:
  #     # Keep only essential host metrics to reduce cardinality
  #     - source_labels: [__name__]
  #       regex: '(node_filesystem_.*|node_network_.*|node_cpu_.*|node_memory_.*|node_load.*|node_disk_.*)'
  #       action: keep
