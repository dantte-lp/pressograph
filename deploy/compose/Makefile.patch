# Патч для Makefile: Обновление путей к Compose файлам
# Применить: cd /opt/projects/repositories/pressure-test-visualizer && patch -p1 < deploy/compose/Makefile.patch
# Или применить вручную (см. ниже)

--- a/Makefile
+++ b/Makefile
@@ -204,7 +204,7 @@
 dev-compose: ## Run development environment (via podman-compose)
 	@echo -e "$(CYAN)Starting development environment via podman-compose...$(NC)"
-	podman-compose -f deploy/compose/docker-compose.dev.yml up -d
+	podman-compose -f deploy/compose/compose.dev.yaml --env-file deploy/compose/.env.dev up -d
 	@echo -e "$(GREEN)Development environment started!$(NC)"

@@ -218,7 +218,7 @@
 prod-compose: ## Run production environment (via podman-compose)
 	@echo -e "$(CYAN)Starting production environment via podman-compose...$(NC)"
-	podman-compose -f deploy/compose/docker-compose.prod.yml up -d
+	podman-compose -f deploy/compose/compose.prod.yaml --env-file deploy/compose/.env.prod up -d
 	@echo -e "$(GREEN)Production environment started!$(NC)"

# ═══════════════════════════════════════════════════════════════════
# MANUAL UPDATE INSTRUCTIONS (если патч не применяется автоматически)
# ═══════════════════════════════════════════════════════════════════

# Найти в Makefile строку ~204:
# dev-compose: ## Run development environment (via podman-compose)
# 	@echo -e "$(CYAN)Starting development environment via podman-compose...$(NC)"
# 	podman-compose -f deploy/compose/docker-compose.dev.yml up -d
# 	@echo -e "$(GREEN)Development environment started!$(NC)"

# ЗАМЕНИТЬ НА:
# dev-compose: ## Run development environment (via podman-compose)
# 	@echo -e "$(CYAN)Starting development environment via podman-compose...$(NC)"
# 	podman-compose -f deploy/compose/compose.dev.yaml --env-file deploy/compose/.env.dev up -d
# 	@echo -e "$(GREEN)Development environment started!$(NC)"


# Найти в Makefile строку ~218:
# prod-compose: ## Run production environment (via podman-compose)
# 	@echo -e "$(CYAN)Starting production environment via podman-compose...$(NC)"
# 	podman-compose -f deploy/compose/docker-compose.prod.yml up -d
# 	@echo -e "$(GREEN)Production environment started!$(NC)"

# ЗАМЕНИТЬ НА:
# prod-compose: ## Run production environment (via podman-compose)
# 	@echo -e "$(CYAN)Starting production environment via podman-compose...$(NC)"
# 	podman-compose -f deploy/compose/compose.prod.yaml --env-file deploy/compose/.env.prod up -d
# 	@echo -e "$(GREEN)Production environment started!$(NC)"


# ═══════════════════════════════════════════════════════════════════
# AUTOMATED REPLACEMENT (sed commands)
# ═══════════════════════════════════════════════════════════════════

# Использовать эти команды для автоматического обновления:

cd /opt/projects/repositories/pressure-test-visualizer

# Backup
cp Makefile Makefile.backup

# Replace docker-compose.dev.yml -> compose.dev.yaml
sed -i 's|deploy/compose/docker-compose\.dev\.yml|deploy/compose/compose.dev.yaml --env-file deploy/compose/.env.dev|g' Makefile

# Replace docker-compose.prod.yml -> compose.prod.yaml
sed -i 's|deploy/compose/docker-compose\.prod\.yml|deploy/compose/compose.prod.yaml --env-file deploy/compose/.env.prod|g' Makefile

# Verify changes
diff Makefile.backup Makefile

echo "✅ Makefile updated"

# ═══════════════════════════════════════════════════════════════════
# VERIFICATION
# ═══════════════════════════════════════════════════════════════════

# После применения патча проверить:

# 1. Синтаксис Makefile
make -n dev-compose
make -n prod-compose

# 2. Функциональность
# make dev-compose  # должен стартовать с новым файлом
# make prod-compose # должен стартовать с новым файлом

# ═══════════════════════════════════════════════════════════════════
