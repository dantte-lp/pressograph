# Repository Guidelines

## Project Structure & Module Organization
- `src/app` hosts Next.js route groups, server components, and layouts.
- `src/components/{ui,pressure-test,providers}` holds reusable React pieces; export PascalCase components.
- `src/config` and `src/lib` contain shared services (auth, db, utilities); import them via the `@/` alias.
- `drizzle/` stores SQL migrations generated by Drizzle Kit; sync the schema with `pnpm db:generate`.
- `tests/{unit,integration,e2e}` mirrors the app layers for Vitest coverage; keep static assets in `public/` and Podman tooling in `deploy/`.

## Build, Test, and Development Commands
- `pnpm dev` starts the Turbopack dev server; `pnpm build` and `pnpm start` produce and serve the production build.
- `pnpm lint`, `pnpm type-check`, and `pnpm format:check` gate merges; favor `pnpm format` for bulk edits.
- `pnpm test` executes Vitest headless; `pnpm test:ui` launches the interactive UI runner.
- Database workflows use `pnpm db:migrate`, `pnpm db:push`, and `pnpm db:studio`.
- Podman helpers live in the Taskfile: `task dev:setup`, `task dev:start`, `task dev:enter`, and `task dev:logs` manage the local containers.

## Coding Style & Naming Conventions
- Prettier enforces two-space indentation, double quotes, trailing commas, and width 100 (see `.prettierrc.json`); do not hand-format.
- ESLint (`eslint.config.mjs`) is required, including Drizzle safety rules (`enforce-delete/update-with-where`).
- Use `PascalCase` for exported React components, `camelCase` utilities, and kebab-case filenames (e.g., `pressure-test-chart.tsx`).
- Reach for Tailwind utilities plus `tailwind-merge`; shared styles live in `src/styles/`.
- Keep environment helpers and database clients in `src/lib`, avoiding deep relative paths.

## Testing Guidelines
- Store specs under `tests/<layer>` and name them `feature-name.test.ts[x]`; collocate fixtures in `__fixtures__`.
- Cover new logic with unit or integration tests and verify regressions before shipping.
- Run `pnpm test -- --coverage` when touching critical flows; maintain the documented ~60% baseline.
- Mock external services (Redis, Drizzle) via Vitest rather than hitting live infrastructure.

## Commit & Pull Request Guidelines
- Favour Conventional Commits (`feat(auth): add MFA enrollment`) or a concise imperative sentence under 72 characters.
- Reference linked issues and list validation commands in the PR description.
- Attach screenshots/logs for UI, observability, or database changes; call out required migrations.
- Ensure `pnpm lint`, `pnpm type-check`, and `pnpm test` succeed locally before requesting review.

## Environment & Security Notes
- Bootstrap configuration with `cp .env.dev.example .env.local` or `task env:template`.
- Rotate secrets via `task secrets:generate`; never commit `.env.local` or generated keys.
- Use `task db:studio` and `task dev:logs` to inspect local services without exposing production credentials.
