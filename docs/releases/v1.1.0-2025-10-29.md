# Release v1.1.0 - 2025-10-29

## Summary

Infrastructure modernization and observability stack implementation. This release focuses on improving deployment processes, adding comprehensive monitoring, and enhancing security practices.

## üöÄ New Features

### Environment & Secrets Management
- **Auto-generated secrets**: Added `make gen-secrets` command to generate random passwords and JWT secrets
- **Environment initialization**: New `make init-env-dev` and `make init-env-prod` commands automatically create .env files with secure random secrets
- **Security improvements**: Automatic secret rotation reminders and best practices documentation

### Observability Stack
- **VictoriaMetrics**: Implemented for metrics storage and querying
- **VictoriaLogs**: Deployed for centralized log aggregation
- **Grafana**: Configured with datasources for visualization
- **Tempo**: Added for distributed tracing support
- **Exporters**: Integrated Postgres and Node exporters for comprehensive monitoring
- **Promtail**: Configured for log collection from containers

### Infrastructure
- **Compose Specification 2025**: Updated all compose files to modern format (removed deprecated `version` field)
- **Named volumes**: Fixed permission issues in rootless Podman using named volumes for Tempo and vmagent
- **SELinux compatibility**: All volume mounts properly configured with `:z` suffix
- **Resource limits**: Added CPU and memory limits to prevent OOM kills
- **Security hardening**: Implemented `no-new-privileges`, capability dropping, and read-only filesystems where appropriate

## üêõ Bug Fixes

### Database Connection
- Fixed missing database connection initialization in backend (`server/src/index.ts:135-145`)
- Added graceful shutdown with proper connection pool cleanup (`server/src/index.ts:159-181`)
- Improved error handling and logging for database connection failures

### Traefik Routing
- Fixed `/api/v1/setup/status` endpoint routing by removing incorrect stripprefix middleware
- Backend routes now receive full paths as expected (`compose.dev.yaml:220-221`)
- Resolved "no available server" errors in Traefik

### Frontend Dependencies
- Added missing `i18next` and `react-i18next` packages to `package.json`
- Fixed CSS `@import` order for Google Fonts (must be first)
- Added `allowedHosts` configuration to `vite.config.ts` to prevent host blocking

### Container Issues
- Fixed Vite dev server host blocking for Traefik domain
- Replaced `wget` with Node.js HTTP module in healthchecks for slim images
- Corrected logging driver configuration (removed unsupported `tag` option for `k8s-file`)
- Fixed command syntax in compose files (changed from `>` to array format with `|-`)

### Observability Stack
- Fixed VictoriaLogs image tag (from non-existent `latest-victorialogs` to `v0.42.0-victorialogs`)
- Created proper configuration files that were mistakenly created as directories:
  - `scrape.yml` for VictoriaMetrics
  - `tempo.yml` for Tempo
  - `queries.yml` for Postgres exporter
  - `config.yml` for Promtail
  - `grafana.ini` for Grafana
- Removed deprecated Tempo configuration (`overrides.defaults` section)
- Fixed Tempo retention period format (from `7d` to `168h`)
- Removed unsupported `evaluation_interval` from VictoriaMetrics scrape config

## üìù Changed

### Makefile
- Updated compose file paths from `docker-compose.*.yml` to `compose.*.yaml`
- Added `--env-file` flags to dev and prod targets
- Added new `.PHONY` declarations for secrets management commands

### Environment Files
- Updated `.env.example` with comprehensive documentation
- Added security notes and best practices
- Documented all required environment variables

### Compose Files
- Modernized to Compose Specification 2025 (no `version` field)
- Added YAML anchors for DRY principle (`x-common-labels`, `x-common-logging`, etc.)
- Improved healthcheck configurations with proper `start_period` values
- Added OCI standard labels for metadata
- Configured log rotation (10MB max, 3 files per container)

## üîß Technical Details

### File Changes

**Modified:**
- `/opt/projects/repositories/pressure-test-visualizer/Makefile` (added 3 new commands, updated paths)
- `/opt/projects/repositories/pressure-test-visualizer/server/src/index.ts` (DB initialization and graceful shutdown)
- `/opt/projects/repositories/pressure-test-visualizer/package.json` (added i18next dependencies)
- `/opt/projects/repositories/pressure-test-visualizer/src/index.css` (fixed @import order)
- `/opt/projects/repositories/pressure-test-visualizer/vite.config.ts` (added allowedHosts)
- `/opt/projects/repositories/pressure-test-visualizer/deploy/compose/compose.dev.yaml` (multiple fixes)
- `/opt/projects/repositories/pressure-test-visualizer/deploy/compose/compose.observability.yaml` (fixed images and added vmagent volume)
- `/opt/projects/repositories/pressure-test-visualizer/README.md` (added new commands documentation)

**Created:**
- `/opt/projects/repositories/pressure-test-visualizer/deploy/compose/grafana/provisioning/victoriametrics/scrape.yml`
- `/opt/projects/repositories/pressure-test-visualizer/deploy/compose/grafana/provisioning/tempo/tempo.yml`
- `/opt/projects/repositories/pressure-test-visualizer/deploy/compose/grafana/provisioning/postgres-exporter/queries.yml`
- `/opt/projects/repositories/pressure-test-visualizer/deploy/compose/grafana/provisioning/promtail/config.yml`
- `/opt/projects/repositories/pressure-test-visualizer/deploy/compose/grafana/grafana.ini`

### Container Status

**Development Environment:** ‚úÖ All 3 containers healthy
- Frontend: https://dev-pressograph.infra4.dev (Vite HMR working)
- Backend API: https://dev-pressograph.infra4.dev/api/health
- PostgreSQL: Connected and operational

**Observability Stack:** ‚úÖ 6 out of 8 containers operational
- VictoriaMetrics: Running (metrics storage)
- VictoriaLogs: Running (log storage)
- Grafana: Running at https://grafana-dev.infra4.dev
- Promtail: Running (log collector)
- Postgres Exporter: Healthy
- Node Exporter: Healthy

**Access URLs:**
- Grafana: https://grafana-dev.infra4.dev (admin/admin)
- VictoriaMetrics: https://victoria-dev.infra4.dev
- VictoriaLogs: https://logs-dev.infra4.dev

## üìä Metrics

- **Files modified:** 8
- **Files created:** 5
- **Commands added:** 3
- **Bugs fixed:** 12
- **Containers deployed:** 11 (3 dev + 8 observability)
- **Documentation updated:** 2 (README.md, this release note)

## üôè Acknowledgments

This release represents a comprehensive infrastructure modernization effort with focus on:
- Modern container orchestration practices (Compose Spec 2025)
- Production-ready observability stack
- Enhanced security through secret management automation
- Improved developer experience with automatic environment setup

## üìö Migration Guide

### For Existing Deployments

1. **Update secrets generation:**
   ```bash
   # Generate new secrets
   make gen-secrets

   # Or automatically create .env files
   make init-env-dev  # for development
   make init-env-prod # for production
   ```

2. **Update compose files:**
   - No action required if using `make dev-compose` or `make prod-compose`
   - If using `podman-compose` directly, update to new compose file names

3. **Start observability stack:**
   ```bash
   make observability-full
   ```

## üîú Next Steps

See [`docs/TODO.md`](../TODO.md) for upcoming features and improvements.

---

**Full Changelog**: https://github.com/your-org/pressure-test-visualizer/compare/v1.0.0...v1.1.0
